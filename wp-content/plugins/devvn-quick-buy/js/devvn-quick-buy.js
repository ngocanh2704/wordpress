!function(c){c(document).ready(function(){function t(a){var n=c(".summary.entry-summary > .cart"),e=c(".devvn_prod_variable .cart",a);c("select, input, textarea",n).each(function(){var a=c(this).attr("name"),n=c(this).val();c('[name="'+a+'"]',e).val(n)}),e.trigger("check_variations"),u(a)}function i(a){var e=c(".summary.entry-summary > .cart"),n=c(".devvn_prod_variable .cart",a);c("select, input, textarea",n).each(function(){var a=c(this).attr("name"),n=c(this).val();c('[name="'+a+'"]',e).val(n)}),e.trigger("check_variations"),u(a)}function u(a){var n=c(".devvn_prod_variable .cart",a).data("product_variations"),e=c('.devvn_prod_variable input[name="quantity"]',a).val(),t=c('.devvn_prod_variable input[name="variation_id"]',a).val(),i=total=ship=0;(c("#enable_ship",a).val()||0)&&0<c(".popup_quickbuy_shipping_calc",a).length&&0<c('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',a).length&&(ship=parseInt(c('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]:checked',a).data("cost")),ship||1!=c('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',a).length||(ship=parseInt(c('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',a).data("cost")))),n?c(n).each(function(a,n){n.variation_id==t&&n.variation_is_active&&n.variation_is_visible&&(i=n.display_price)}):i=c(".devvn_prod_variable",a).data("simpleprice"),total=i*e+ship,c(".popup_quickbuy_total_calc",a).html(function(a,n,e,t){n=devvn_quickbuy_array.num_decimals,e=devvn_quickbuy_array.price_decimal,a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var i=isFinite(+a)?+a:0,o=isFinite(+n)?Math.abs(n):0,r=void 0===t?",":t,d=void 0===e?".":e,p="";3<(p=(o?(u=i,c=o,v=Math.pow(10,c),""+Math.round(u*v)/v):""+Math.round(i)).split("."))[0].length&&(p[0]=p[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,r));var u,c,v;(p[1]||"").length<o&&(p[1]=p[1]||"",p[1]+=new Array(o-p[1].length+1).join("0"));return p.join(d)}(total.toFixed(0),0,"",".")+" "+devvn_quickbuy_array.currency_format)}function o(){0<c("body .devvn_prod_variable").length&&0==c("body .devvn_prod_variable .quantity.buttons_added .screen-reader-text").length&&c("body .devvn_prod_variable .quantity.buttons_added").append('<label class="screen-reader-text">'+devvn_quickbuy_array.qty_text+"</label>"),c("body .devvn-popup-quickbuy").each(function(){var i=c(this),a=c(".devvn_cusstom_info",i);a.validate({rules:{"customer-name":{required:!0,maxlength:100},"customer-phone":{required:{depends:function(){return c(this).val(c.trim(c(this).val())),!0}},vietnamphone:!0},"customer-quan":{required:function(a){return 1==c("#require_district").val()}},"customer-xa":{required:function(a){return 1==c("#require_village").val()}},"customer-address":{required:function(a){return 1==c("#require_address").val()}},"customer-email":{required:function(a){return 1==c(a).data("required")},customemail:!0}},messages:{"customer-name":devvn_quickbuy_array.name_text,"customer-phone":devvn_quickbuy_array.phone_text,"customer-email":devvn_quickbuy_array.email_text,"customer-quan":devvn_quickbuy_array.quan_text,"customer-xa":devvn_quickbuy_array.xa_text,"customer-address":devvn_quickbuy_array.address_text},errorLabelContainer:c(".devvn_quickbuy_mess",a)});var o=c("#enable_ship",i).val()||0;if(0<c("#devvn_city",i).length){var r=!1,d=c("#prod_nonce",i).val(),p=0;0<c('button.single_add_to_cart_button[name="add-to-cart"]',i).length&&(p=parseInt(c('button.single_add_to_cart_button[name="add-to-cart"], thisForm').val())),c("#devvn_city",i).on("change",function(a){var n=a.val;if(n||(n=c("#devvn_city option:selected",i).val()),n&&!r){var e=c(".devvn_prod_variable .cart",i).serialize();c.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:n,getvalue:1,product_info:e,nonce:d,prod_id:p},context:this,beforeSend:function(){c(".popup-customer-info",i).addClass("popup_loading"),r=!0},success:function(a){if(c("#devvn_district",i).html(""),c("#devvn_ward",i).html('<option value="">Xã/phường</option>'),a.success){var n=a.data.list_district,e=new Option("Quận/huyện","");c("#devvn_district",i).append(e),c.each(n,function(a,n){var e=new Option(n.name,n.maqh);c("#devvn_district",i).append(e)}),o&&a.data.shipping&&c(".popup_quickbuy_shipping_calc",i).html(a.data.shipping)}r=!1,c(".popup-customer-info",i).removeClass("popup_loading"),u(i)}})}}),0<c("#devvn_district",i).length&&c("#devvn_district",i).on("change",function(a){var n=a.val;n||(n=c("#devvn_district option:selected",i).val());var e=c("#devvn_city option:selected",i).val();if(n&&!r){var t=c(".devvn_prod_variable .cart",i).serialize();c.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:e,maqh:n,getvalue:2,product_info:t,nonce:d,prod_id:p},context:this,beforeSend:function(){c(".popup-customer-info",i).addClass("popup_loading"),r=!0},success:function(a){if(c("#devvn_ward",i).html(""),a.success){var n=a.data.list_district,e=new Option("Xã/phường","");c("#devvn_ward",i).append(e),c.each(n,function(a,n){var e=new Option(n.name,n.xaid);c("#devvn_ward",i).append(e)}),o&&a.data.shipping&&c(".popup_quickbuy_shipping_calc",i).html(a.data.shipping)}r=!1,c(".popup-customer-info",i).removeClass("popup_loading"),u(i)}})}}),c(window).on("load",function(){c("#devvn_city",i).trigger("change")}),c(".devvn_prod_variable .cart",i).on("change",function(a){if(o){var n=c("#devvn_district option:selected",i).val(),e=c("#devvn_city option:selected",i).val(),t=c(".devvn_prod_variable .cart",i).serialize();c.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"quickbuy_load_diagioihanhchinh",matp:e,maqh:n,getvalue:1,product_info:t,nonce:d,prod_id:p},context:this,beforeSend:function(){c(".popup-customer-info",i).addClass("popup_loading")},success:function(a){a.success&&o&&a.data.shipping&&c(".popup_quickbuy_shipping_calc",i).html(a.data.shipping),c(".popup-customer-info",i).removeClass("popup_loading"),u(i)}})}})}c("#devvn_cusstom_info, .devvn_prod_variable .cart, input.variation_id",i).on("change",function(){u(i)})})}c(".devvn_buy_now").on("click",function(){var n=c(this).data("id"),e=c("#popup_content_"+n);c(".devvn-popup-content_"+n).hasClass("ghn_not_loaded")?c.ajax({type:"post",dataType:"html",url:devvn_quickbuy_array.ajaxurl,data:{action:"devvn_form_quickbuy",prodid:n},context:this,beforeSend:function(){c(this).addClass("popup_loading")},success:function(a){c(".devvn-popup-content_"+n).html(a),c(".popup_quickbuy_shipping_calc").html(""),o(),c("#devvn_city",e).trigger("change"),u(e),"undefined"!=typeof wc_add_to_cart_variation_params&&c(".variations_form").each(function(){c(this).wc_variation_form()}),c("#popup_content_"+n).bPopup({speed:450,transition:"slideDown",zIndex:9999999,closeClass:"devvn-popup-close",onOpen:function(){t(e)},onClose:function(){c(".devvn-popup-content_"+n).html(""),i(e)}}),c(this).removeClass("popup_loading")},error:function(a,n,e){c(this).removeClass("popup_loading")}}):c("#popup_content_"+n).bPopup({speed:450,transition:"slideDown",zIndex:9999999,closeClass:"devvn-popup-close",onOpen:function(){t(e),(c("#enable_ship",e).val()||0)&&0<c(".popup_quickbuy_shipping_calc",e).length&&c('.popup_quickbuy_shipping_calc input[name="shipping_method[0]"]',e).length<=0&&c("#devvn_city",e).trigger("change")},onClose:function(){i(e)}})}),c.validator.addMethod("vietnamphone",function(a,n){return/^0+(\d{9,10})$/.test(a)},"Số điện thoại không đúng định dạng."),c.validator.addMethod("customemail",function(a,n){return""==a||/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(a)},"Định dạng email không đúng."),o();var d=!1;c("body").on("click",".devvn-order-btn",function(){var t=c(this).closest(".devvn-popup-quickbuy"),a=c(".devvn_cusstom_info",t),n=c('.devvn_prod_variable .cart input[name="variation_id"]',t).val();if("string"==typeof n&&"0"!=n&&""!=n||void 0===n)if(0<c(".devvn_prod_variable .out-of-stock",t).length)alert(devvn_quickbuy_array.out_of_stock_mess);else{if(!a.valid())return;var e=c("#prod_nonce",t).val(),i=c("#prod_id",t).val(),o=c("#devvn_cusstom_info",t).serialize(),r=c(".devvn_prod_variable .cart",t).serialize();d||c.ajax({type:"post",dataType:"json",url:devvn_quickbuy_array.ajaxurl,data:{action:"devvn_quickbuy",prod_id:i,customer_info:o,product_info:r,nonce:e},context:this,beforeSend:function(){d=!0,c(".devvn-order-btn",t).addClass("loading")},success:function(a){a.success?a.data.gotothankyou&&a.data.thankyou_link?window.location.href=a.data.thankyou_link:c(".devvn-popup-content",t).html(a.data.content):alert(devvn_quickbuy_array.popup_error),d=!1,c(".devvn-order-btn",t).removeClass("loading")},error:function(a,n,e){alert(devvn_quickbuy_array.popup_error),d=!1,c(".devvn-order-btn",t).removeClass("loading")}})}else alert(wc_add_to_cart_variation_params.i18n_make_a_selection_text);return!1})})}(jQuery);